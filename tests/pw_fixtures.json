{"patches/?since=2020-10-06T00:00:00&state=1&archived=False&project=399&delegate=121173&": [{"id": 11832003, "url": "https://patchwork.kernel.org/api/1.1/patches/11832003/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/patch/20201012091850.67452-1-lmb@cloudflare.com/", "project": {"id": 399, "url": "https://patchwork.kernel.org/api/1.1/projects/399/", "name": "Netdev + BPF", "link_name": "netdevbpf", "list_id": "bpf.vger.kernel.org", "list_email": "bpf@vger.kernel.org", "web_url": "", "scm_url": "", "webscm_url": ""}, "msgid": "<20201012091850.67452-1-lmb@cloudflare.com>", "date": "2020-10-12T09:18:50", "name": "[bpf] bpf: sockmap: add locking annotations to iterator", "commit_ref": null, "pull_url": null, "state": "new", "archived": false, "hash": "2813e93828c756579a59493592bd73b6d3828ac2", "submitter": {"id": 190187, "url": "https://patchwork.kernel.org/api/1.1/people/190187/", "name": "Lorenz Bauer", "email": "lmb@cloudflare.com"}, "delegate": {"id": 121173, "url": "https://patchwork.kernel.org/api/1.1/users/121173/", "username": "bpf", "first_name": "BPF", "last_name": "", "email": "bpf@iogearbox.net"}, "mbox": "https://patchwork.kernel.org/project/netdevbpf/patch/20201012091850.67452-1-lmb@cloudflare.com/mbox/", "series": [{"id": 363071, "url": "https://patchwork.kernel.org/api/1.1/series/363071/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/list/?series=363071", "date": "2020-10-12T09:18:50", "name": "[bpf] bpf: sockmap: add locking annotations to iterator", "version": 1, "mbox": "https://patchwork.kernel.org/series/363071/mbox/"}], "comments": "https://patchwork.kernel.org/api/patches/11832003/comments/", "check": "pending", "checks": "https://patchwork.kernel.org/api/patches/11832003/checks/", "tags": {}}, {"id": 11833459, "url": "https://patchwork.kernel.org/api/1.1/patches/11833459/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/patch/20201012170952.60750-1-alex.dewar90@gmail.com/", "project": {"id": 399, "url": "https://patchwork.kernel.org/api/1.1/projects/399/", "name": "Netdev + BPF", "link_name": "netdevbpf", "list_id": "bpf.vger.kernel.org", "list_email": "bpf@vger.kernel.org", "web_url": "", "scm_url": "", "webscm_url": ""}, "msgid": "<20201012170952.60750-1-alex.dewar90@gmail.com>", "date": "2020-10-12T17:09:53", "name": "net: sockmap: Don't call bpf_prog_put() on NULL pointer", "commit_ref": null, "pull_url": null, "state": "new", "archived": false, "hash": "d4f46eefb0aa37e4bac19271697d1d727784b278", "submitter": {"id": 193843, "url": "https://patchwork.kernel.org/api/1.1/people/193843/", "name": "Alex Dewar", "email": "alex.dewar90@gmail.com"}, "delegate": {"id": 121173, "url": "https://patchwork.kernel.org/api/1.1/users/121173/", "username": "bpf", "first_name": "BPF", "last_name": "", "email": "bpf@iogearbox.net"}, "mbox": "https://patchwork.kernel.org/project/netdevbpf/patch/20201012170952.60750-1-alex.dewar90@gmail.com/mbox/", "series": [{"id": 363425, "url": "https://patchwork.kernel.org/api/1.1/series/363425/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/list/?series=363425", "date": "2020-10-12T17:09:53", "name": "net: sockmap: Don't call bpf_prog_put() on NULL pointer", "version": 1, "mbox": "https://patchwork.kernel.org/series/363425/mbox/"}], "comments": "https://patchwork.kernel.org/api/patches/11833459/comments/", "check": "pending", "checks": "https://patchwork.kernel.org/api/patches/11833459/checks/", "tags": {}}, {"id": 11834517, "url": "https://patchwork.kernel.org/api/1.1/patches/11834517/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/patch/20201012234940.1707941-1-kafai@fb.com/", "project": {"id": 399, "url": "https://patchwork.kernel.org/api/1.1/projects/399/", "name": "Netdev + BPF", "link_name": "netdevbpf", "list_id": "bpf.vger.kernel.org", "list_email": "bpf@vger.kernel.org", "web_url": "", "scm_url": "", "webscm_url": ""}, "msgid": "<20201012234940.1707941-1-kafai@fb.com>", "date": "2020-10-12T23:49:40", "name": "[bpf] bpf: selftest: Fix flaky tcp_hdr_options test when adding addr to lo", "commit_ref": null, "pull_url": null, "state": "new", "archived": false, "hash": "451c79f5dfa5dd56622b22a605fefdddbfa6026e", "submitter": {"id": 99511, "url": "https://patchwork.kernel.org/api/1.1/people/99511/", "name": "Martin KaFai Lau", "email": "kafai@fb.com"}, "delegate": {"id": 121173, "url": "https://patchwork.kernel.org/api/1.1/users/121173/", "username": "bpf", "first_name": "BPF", "last_name": "", "email": "bpf@iogearbox.net"}, "mbox": "https://patchwork.kernel.org/project/netdevbpf/patch/20201012234940.1707941-1-kafai@fb.com/mbox/", "series": [{"id": 363589, "url": "https://patchwork.kernel.org/api/1.1/series/363589/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/list/?series=363589", "date": "2020-10-12T23:49:40", "name": "[bpf] bpf: selftest: Fix flaky tcp_hdr_options test when adding addr to lo", "version": 1, "mbox": "https://patchwork.kernel.org/series/363589/mbox/"}], "comments": "https://patchwork.kernel.org/api/patches/11834517/comments/", "check": "pending", "checks": "https://patchwork.kernel.org/api/patches/11834517/checks/", "tags": {}}, {"id": 11836751, "url": "https://patchwork.kernel.org/api/1.1/patches/11836751/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/patch/20201014043638.3770558-1-songliubraving@fb.com/", "project": {"id": 399, "url": "https://patchwork.kernel.org/api/1.1/projects/399/", "name": "Netdev + BPF", "link_name": "netdevbpf", "list_id": "bpf.vger.kernel.org", "list_email": "bpf@vger.kernel.org", "web_url": "", "scm_url": "", "webscm_url": ""}, "msgid": "<20201014043638.3770558-1-songliubraving@fb.com>", "date": "2020-10-14T04:36:38", "name": "[bpf-next] selftests/bpf: fix compilation error in progs/profiler.inc.h", "commit_ref": null, "pull_url": null, "state": "new", "archived": false, "hash": "af6c42693fdf608dd3ff5981dd1eb261082d1958", "submitter": {"id": 172541, "url": "https://patchwork.kernel.org/api/1.1/people/172541/", "name": "Song Liu", "email": "songliubraving@fb.com"}, "delegate": {"id": 121173, "url": "https://patchwork.kernel.org/api/1.1/users/121173/", "username": "bpf", "first_name": "BPF", "last_name": "", "email": "bpf@iogearbox.net"}, "mbox": "https://patchwork.kernel.org/project/netdevbpf/patch/20201014043638.3770558-1-songliubraving@fb.com/mbox/", "series": [{"id": 364283, "url": "https://patchwork.kernel.org/api/1.1/series/364283/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/list/?series=364283", "date": "2020-10-14T04:36:38", "name": "[bpf-next] selftests/bpf: fix compilation error in progs/profiler.inc.h", "version": 1, "mbox": "https://patchwork.kernel.org/series/364283/mbox/"}], "comments": "https://patchwork.kernel.org/api/patches/11836751/comments/", "check": "pending", "checks": "https://patchwork.kernel.org/api/patches/11836751/checks/", "tags": {}}], "series/?q= bpf: sockmap: add locking annotations to iterator&": [{"id": 363071, "url": "https://patchwork.kernel.org/api/1.1/series/363071/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/list/?series=363071", "project": {"id": 399, "url": "https://patchwork.kernel.org/api/1.1/projects/399/", "name": "Netdev + BPF", "link_name": "netdevbpf", "list_id": "bpf.vger.kernel.org", "list_email": "bpf@vger.kernel.org", "web_url": "", "scm_url": "", "webscm_url": ""}, "name": "[bpf] bpf: sockmap: add locking annotations to iterator", "date": "2020-10-12T09:18:50", "submitter": {"id": 190187, "url": "https://patchwork.kernel.org/api/1.1/people/190187/", "name": "Lorenz Bauer", "email": "lmb@cloudflare.com"}, "version": 1, "total": 1, "received_total": 1, "received_all": true, "mbox": "https://patchwork.kernel.org/series/363071/mbox/", "cover_letter": null, "patches": [{"id": 11832003, "url": "https://patchwork.kernel.org/api/1.1/patches/11832003/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/patch/20201012091850.67452-1-lmb@cloudflare.com/", "msgid": "<20201012091850.67452-1-lmb@cloudflare.com>", "date": "2020-10-12T09:18:50", "name": "[bpf] bpf: sockmap: add locking annotations to iterator", "mbox": "https://patchwork.kernel.org/project/netdevbpf/patch/20201012091850.67452-1-lmb@cloudflare.com/mbox/"}]}], "patches/11832003/": {"id": 11832003, "url": "https://patchwork.kernel.org/api/1.1/patches/11832003/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/patch/20201012091850.67452-1-lmb@cloudflare.com/", "project": {"id": 399, "url": "https://patchwork.kernel.org/api/1.1/projects/399/", "name": "Netdev + BPF", "link_name": "netdevbpf", "list_id": "bpf.vger.kernel.org", "list_email": "bpf@vger.kernel.org", "web_url": "", "scm_url": "", "webscm_url": ""}, "msgid": "<20201012091850.67452-1-lmb@cloudflare.com>", "date": "2020-10-12T09:18:50", "name": "[bpf] bpf: sockmap: add locking annotations to iterator", "commit_ref": null, "pull_url": null, "state": "new", "archived": false, "hash": "2813e93828c756579a59493592bd73b6d3828ac2", "submitter": {"id": 190187, "url": "https://patchwork.kernel.org/api/1.1/people/190187/", "name": "Lorenz Bauer", "email": "lmb@cloudflare.com"}, "delegate": {"id": 121173, "url": "https://patchwork.kernel.org/api/1.1/users/121173/", "username": "bpf", "first_name": "BPF", "last_name": "", "email": "bpf@iogearbox.net"}, "mbox": "https://patchwork.kernel.org/project/netdevbpf/patch/20201012091850.67452-1-lmb@cloudflare.com/mbox/", "series": [{"id": 363071, "url": "https://patchwork.kernel.org/api/1.1/series/363071/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/list/?series=363071", "date": "2020-10-12T09:18:50", "name": "[bpf] bpf: sockmap: add locking annotations to iterator", "version": 1, "mbox": "https://patchwork.kernel.org/series/363071/mbox/"}], "comments": "https://patchwork.kernel.org/api/patches/11832003/comments/", "check": "pending", "checks": "https://patchwork.kernel.org/api/patches/11832003/checks/", "tags": {}, "headers": {"Return-Path": "<SRS0=+vlE=DT=vger.kernel.org=bpf-owner@kernel.org>", "X-Spam-Checker-Version": "SpamAssassin 3.4.0 (2014-02-07) on\n\taws-us-west-2-korg-lkml-1.web.codeaurora.org", "X-Spam-Level": "", "X-Spam-Status": "No, score=-12.8 required=3.0 tests=BAYES_00,DKIMWL_WL_HIGH,\n\tDKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,HEADER_FROM_DIFFERENT_DOMAINS,\n\tINCLUDES_PATCH,MAILING_LIST_MULTI,SIGNED_OFF_BY,SPF_HELO_NONE,SPF_PASS,\n\tURIBL_BLOCKED,USER_AGENT_GIT autolearn=unavailable autolearn_force=no\n\tversion=3.4.0", "Received": ["from mail.kernel.org (mail.kernel.org [198.145.29.99])\n\tby smtp.lore.kernel.org (Postfix) with ESMTP id D16C9C433DF\n\tfor <bpf@archiver.kernel.org>; Mon, 12 Oct 2020 09:20:01 +0000 (UTC)", "from vger.kernel.org (vger.kernel.org [23.128.96.18])\n\tby mail.kernel.org (Postfix) with ESMTP id 713A3208D5\n\tfor <bpf@archiver.kernel.org>; Mon, 12 Oct 2020 09:19:59 +0000 (UTC)", "(majordomo@vger.kernel.org) by vger.kernel.org via listexpand\n        id S1729203AbgJLJT7 (ORCPT <rfc822;bpf@archiver.kernel.org>);\n        Mon, 12 Oct 2020 05:19:59 -0400", "from lindbergh.monkeyblade.net ([23.128.96.19]:47266 \"EHLO\n        lindbergh.monkeyblade.net\" rhost-flags-OK-OK-OK-OK) by vger.kernel.org\n        with ESMTP id S1729201AbgJLJT5 (ORCPT <rfc822;bpf@vger.kernel.org>);\n        Mon, 12 Oct 2020 05:19:57 -0400", "from mail-ej1-x642.google.com (mail-ej1-x642.google.com\n [IPv6:2a00:1450:4864:20::642])\n        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 5C72BC0613D1\n        for <bpf@vger.kernel.org>; Mon, 12 Oct 2020 02:19:55 -0700 (PDT)", "by mail-ej1-x642.google.com with SMTP id c22so22252244ejx.0\n        for <bpf@vger.kernel.org>; Mon, 12 Oct 2020 02:19:55 -0700 (PDT)", "from antares.fritz.box\n (p200300c1c70304000403afa763d01b3d.dip0.t-ipconnect.de.\n [2003:c1:c703:400:403:afa7:63d0:1b3d])\n        by smtp.gmail.com with ESMTPSA id\n q12sm10396834edj.19.2020.10.12.02.19.52\n        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);\n        Mon, 12 Oct 2020 02:19:53 -0700 (PDT)"], "Authentication-Results": "mail.kernel.org;\n\tdkim=pass (1024-bit key) header.d=cloudflare.com header.i=@cloudflare.com\n header.b=\"CbKK+gRv\"", "DKIM-Signature": "v=1; a=rsa-sha256; c=relaxed/relaxed;\n        d=cloudflare.com; s=google;\n        h=from:to:cc:subject:date:message-id:mime-version\n         :content-transfer-encoding;\n        bh=aB+F+LSfyZ6/dCTwKyQPt5hR5XIkYtzIf7awe/NipxE=;\n        b=CbKK+gRvc5v/iI/hT1XnCe2gT1iPQqtKxcpeQ41tF5kfGLK8b/Dr2YAebJKojI6/HT\n         rFs4DD8eMc+LSWr190vq5r8PzdviFYrKXtOM6T2YVd1ualqEeohRgJo2sSIUolHT2g+W\n         2bFOU+zjyqSG+hjrBoptoIEU4gFLRYBMPlAKw=", "X-Google-DKIM-Signature": "v=1; a=rsa-sha256; c=relaxed/relaxed;\n        d=1e100.net; s=20161025;\n        h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version\n         :content-transfer-encoding;\n        bh=aB+F+LSfyZ6/dCTwKyQPt5hR5XIkYtzIf7awe/NipxE=;\n        b=uH/tw809ia1euE6FcJgjFo+l8Ij9NH/ZpXZSN3Ssi5nZG9pUpZi21a8YqmcRKFNhcQ\n         KcZosT8701tU6mSHltdGB2WlMf31x3pnWESrIHSq8wVOZ2HCpEgS6osLLlEaHcKFwUBg\n         xcyJyt7N3vKkRLjvxyh8j5xFm06+wotJdbSH6T1BinEOjm2JHZeQ/aG24s9wf+rNV/hv\n         EDm9UR5WRq4At5/uzKHWXVAHsnsmTwZHFavcYbj8OnFl8m5tB1zSXweEcu35VChdqwIy\n         MRcYoXeks5WuuIc4QPZC1iVSiLnDWnW3/+3FaBN/zsn4rwExSvo4rEz8ikYi4LAoBWob\n         iocg==", "X-Gm-Message-State": "AOAM533C3+nofYT4OLetmcT2DmttMEdA9jrGRgO5xmF70Lb64th2Sd6M\n        vLDbWC9spIK0RW0QsDopO6/gmw==", "X-Google-Smtp-Source": "\n ABdhPJx5XFsHT27Sb+fbFnWQZZXJQ6H7gYYZAkdJY19fb6/Z4DDcglvpr773N2/AJurdT8ugzMOygQ==", "X-Received": "by 2002:a17:906:4e06:: with SMTP id\n z6mr28296939eju.370.1602494393813;\n        Mon, 12 Oct 2020 02:19:53 -0700 (PDT)", "From": "Lorenz Bauer <lmb@cloudflare.com>", "To": "John Fastabend <john.fastabend@gmail.com>,\n        Daniel Borkmann <daniel@iogearbox.net>,\n        Jakub Sitnicki <jakub@cloudflare.com>,\n        Lorenz Bauer <lmb@cloudflare.com>,\n        \"David S. Miller\" <davem@davemloft.net>,\n        Jakub Kicinski <kuba@kernel.org>,\n        Alexei Starovoitov <ast@kernel.org>, Yonghong Song <yhs@fb.com>", "Cc": "kernel-team@cloudflare.com, kernel test robot <lkp@intel.com>,\n        netdev@vger.kernel.org, bpf@vger.kernel.org,\n        linux-kernel@vger.kernel.org", "Subject": "[PATCH bpf] bpf: sockmap: add locking annotations to iterator", "Date": "Mon, 12 Oct 2020 11:18:50 +0200", "Message-Id": "<20201012091850.67452-1-lmb@cloudflare.com>", "X-Mailer": "git-send-email 2.25.1", "MIME-Version": "1.0", "Content-Transfer-Encoding": "8bit", "Precedence": "bulk", "List-ID": "<bpf.vger.kernel.org>", "X-Mailing-List": "bpf@vger.kernel.org", "X-Patchwork-Delegate": "bpf@iogearbox.net"}, "content": "The sparse checker currently outputs the following warnings:\n\n    include/linux/rcupdate.h:632:9: sparse: sparse: context imbalance in 'sock_hash_seq_start' - wrong count at exit\n    include/linux/rcupdate.h:632:9: sparse: sparse: context imbalance in 'sock_map_seq_start' - wrong count at exit\n\nAdd the necessary __acquires and __release annotations to make the\niterator locking schema palatable to sparse. Also add __must_hold\nfor good measure.\n\nThe kernel codebase uses both __acquires(rcu) and __acquires(RCU).\nI couldn't find any guidance which one is preferred, so I used\nwhat is easier to type out.\n\nFixes: 0365351524d7 (\"net: Allow iterating sockmap and sockhash\")\nReported-by: kernel test robot <lkp@intel.com>\nSigned-off-by: Lorenz Bauer <lmb@cloudflare.com>\n---\n net/core/sock_map.c | 8 ++++++++\n 1 file changed, 8 insertions(+)", "diff": "diff --git a/net/core/sock_map.c b/net/core/sock_map.c\nindex df09c39a4dd2..203900a6ca5f 100644\n--- a/net/core/sock_map.c\n+++ b/net/core/sock_map.c\n@@ -745,6 +745,7 @@ static void *sock_map_seq_lookup_elem(struct sock_map_seq_info *info)\n }\n \n static void *sock_map_seq_start(struct seq_file *seq, loff_t *pos)\n+\t__acquires(rcu)\n {\n \tstruct sock_map_seq_info *info = seq->private;\n \n@@ -757,6 +758,7 @@ static void *sock_map_seq_start(struct seq_file *seq, loff_t *pos)\n }\n \n static void *sock_map_seq_next(struct seq_file *seq, void *v, loff_t *pos)\n+\t__must_hold(rcu)\n {\n \tstruct sock_map_seq_info *info = seq->private;\n \n@@ -767,6 +769,7 @@ static void *sock_map_seq_next(struct seq_file *seq, void *v, loff_t *pos)\n }\n \n static int sock_map_seq_show(struct seq_file *seq, void *v)\n+\t__must_hold(rcu)\n {\n \tstruct sock_map_seq_info *info = seq->private;\n \tstruct bpf_iter__sockmap ctx = {};\n@@ -789,6 +792,7 @@ static int sock_map_seq_show(struct seq_file *seq, void *v)\n }\n \n static void sock_map_seq_stop(struct seq_file *seq, void *v)\n+\t__releases(rcu)\n {\n \tif (!v)\n \t\t(void)sock_map_seq_show(seq, NULL);\n@@ -1353,6 +1357,7 @@ static void *sock_hash_seq_find_next(struct sock_hash_seq_info *info,\n }\n \n static void *sock_hash_seq_start(struct seq_file *seq, loff_t *pos)\n+\t__acquires(rcu)\n {\n \tstruct sock_hash_seq_info *info = seq->private;\n \n@@ -1365,6 +1370,7 @@ static void *sock_hash_seq_start(struct seq_file *seq, loff_t *pos)\n }\n \n static void *sock_hash_seq_next(struct seq_file *seq, void *v, loff_t *pos)\n+\t__must_hold(rcu)\n {\n \tstruct sock_hash_seq_info *info = seq->private;\n \n@@ -1373,6 +1379,7 @@ static void *sock_hash_seq_next(struct seq_file *seq, void *v, loff_t *pos)\n }\n \n static int sock_hash_seq_show(struct seq_file *seq, void *v)\n+\t__must_hold(rcu)\n {\n \tstruct sock_hash_seq_info *info = seq->private;\n \tstruct bpf_iter__sockmap ctx = {};\n@@ -1396,6 +1403,7 @@ static int sock_hash_seq_show(struct seq_file *seq, void *v)\n }\n \n static void sock_hash_seq_stop(struct seq_file *seq, void *v)\n+\t__releases(rcu)\n {\n \tif (!v)\n \t\t(void)sock_hash_seq_show(seq, NULL);\n", "prefixes": ["bpf"]}, "series/?q=net: sockmap: Don't call bpf_prog_put() on NULL pointer&": [{"id": 363425, "url": "https://patchwork.kernel.org/api/1.1/series/363425/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/list/?series=363425", "project": {"id": 399, "url": "https://patchwork.kernel.org/api/1.1/projects/399/", "name": "Netdev + BPF", "link_name": "netdevbpf", "list_id": "bpf.vger.kernel.org", "list_email": "bpf@vger.kernel.org", "web_url": "", "scm_url": "", "webscm_url": ""}, "name": "net: sockmap: Don't call bpf_prog_put() on NULL pointer", "date": "2020-10-12T17:09:53", "submitter": {"id": 193843, "url": "https://patchwork.kernel.org/api/1.1/people/193843/", "name": "Alex Dewar", "email": "alex.dewar90@gmail.com"}, "version": 1, "total": 1, "received_total": 1, "received_all": true, "mbox": "https://patchwork.kernel.org/series/363425/mbox/", "cover_letter": null, "patches": [{"id": 11833459, "url": "https://patchwork.kernel.org/api/1.1/patches/11833459/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/patch/20201012170952.60750-1-alex.dewar90@gmail.com/", "msgid": "<20201012170952.60750-1-alex.dewar90@gmail.com>", "date": "2020-10-12T17:09:53", "name": "net: sockmap: Don't call bpf_prog_put() on NULL pointer", "mbox": "https://patchwork.kernel.org/project/netdevbpf/patch/20201012170952.60750-1-alex.dewar90@gmail.com/mbox/"}]}], "patches/11833459/": {"id": 11833459, "url": "https://patchwork.kernel.org/api/1.1/patches/11833459/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/patch/20201012170952.60750-1-alex.dewar90@gmail.com/", "project": {"id": 399, "url": "https://patchwork.kernel.org/api/1.1/projects/399/", "name": "Netdev + BPF", "link_name": "netdevbpf", "list_id": "bpf.vger.kernel.org", "list_email": "bpf@vger.kernel.org", "web_url": "", "scm_url": "", "webscm_url": ""}, "msgid": "<20201012170952.60750-1-alex.dewar90@gmail.com>", "date": "2020-10-12T17:09:53", "name": "net: sockmap: Don't call bpf_prog_put() on NULL pointer", "commit_ref": null, "pull_url": null, "state": "new", "archived": false, "hash": "d4f46eefb0aa37e4bac19271697d1d727784b278", "submitter": {"id": 193843, "url": "https://patchwork.kernel.org/api/1.1/people/193843/", "name": "Alex Dewar", "email": "alex.dewar90@gmail.com"}, "delegate": {"id": 121173, "url": "https://patchwork.kernel.org/api/1.1/users/121173/", "username": "bpf", "first_name": "BPF", "last_name": "", "email": "bpf@iogearbox.net"}, "mbox": "https://patchwork.kernel.org/project/netdevbpf/patch/20201012170952.60750-1-alex.dewar90@gmail.com/mbox/", "series": [{"id": 363425, "url": "https://patchwork.kernel.org/api/1.1/series/363425/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/list/?series=363425", "date": "2020-10-12T17:09:53", "name": "net: sockmap: Don't call bpf_prog_put() on NULL pointer", "version": 1, "mbox": "https://patchwork.kernel.org/series/363425/mbox/"}], "comments": "https://patchwork.kernel.org/api/patches/11833459/comments/", "check": "pending", "checks": "https://patchwork.kernel.org/api/patches/11833459/checks/", "tags": {}, "headers": {"Return-Path": "<SRS0=+vlE=DT=vger.kernel.org=bpf-owner@kernel.org>", "X-Spam-Checker-Version": "SpamAssassin 3.4.0 (2014-02-07) on\n\taws-us-west-2-korg-lkml-1.web.codeaurora.org", "X-Spam-Level": "", "X-Spam-Status": "No, score=-12.3 required=3.0 tests=BAYES_00,\n\tDKIM_ADSP_CUSTOM_MED,DKIM_INVALID,DKIM_SIGNED,FREEMAIL_FORGED_FROMDOMAIN,\n\tFREEMAIL_FROM,HEADER_FROM_DIFFERENT_DOMAINS,INCLUDES_PATCH,MAILING_LIST_MULTI,\n\tSIGNED_OFF_BY,SPF_HELO_NONE,SPF_PASS,USER_AGENT_GIT autolearn=unavailable\n\tautolearn_force=no version=3.4.0", "Received": ["from mail.kernel.org (mail.kernel.org [198.145.29.99])\n\tby smtp.lore.kernel.org (Postfix) with ESMTP id D5EFEC433E7\n\tfor <bpf@archiver.kernel.org>; Mon, 12 Oct 2020 17:10:44 +0000 (UTC)", "from vger.kernel.org (vger.kernel.org [23.128.96.18])\n\tby mail.kernel.org (Postfix) with ESMTP id 8700120878\n\tfor <bpf@archiver.kernel.org>; Mon, 12 Oct 2020 17:10:44 +0000 (UTC)", "(majordomo@vger.kernel.org) by vger.kernel.org via listexpand\n        id S2403963AbgJLRKj (ORCPT <rfc822;bpf@archiver.kernel.org>);\n        Mon, 12 Oct 2020 13:10:39 -0400", "from lindbergh.monkeyblade.net ([23.128.96.19]:35472 \"EHLO\n        lindbergh.monkeyblade.net\" rhost-flags-OK-OK-OK-OK) by vger.kernel.org\n        with ESMTP id S2403948AbgJLRKj (ORCPT <rfc822;bpf@vger.kernel.org>);\n        Mon, 12 Oct 2020 13:10:39 -0400", "from mail-wr1-x442.google.com (mail-wr1-x442.google.com\n [IPv6:2a00:1450:4864:20::442])\n        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 26F92C0613D0;\n        Mon, 12 Oct 2020 10:10:39 -0700 (PDT)", "by mail-wr1-x442.google.com with SMTP id x7so11425791wrl.3;\n        Mon, 12 Oct 2020 10:10:39 -0700 (PDT)", "from localhost.localdomain\n (cpc83661-brig20-2-0-cust443.3-3.cable.virginm.net. [82.28.105.188])\n        by smtp.gmail.com with ESMTPSA id\n l11sm27199166wrt.54.2020.10.12.10.10.36\n        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);\n        Mon, 12 Oct 2020 10:10:37 -0700 (PDT)"], "Authentication-Results": "mail.kernel.org;\n\tdkim=fail reason=\"signature verification failed\" (2048-bit key)\n header.d=gmail.com header.i=@gmail.com header.b=\"s2r4/v0D\"", "DKIM-Signature": "v=1; a=rsa-sha256; c=relaxed/relaxed;\n        d=gmail.com; s=20161025;\n        h=from:to:cc:subject:date:message-id:mime-version\n         :content-transfer-encoding;\n        bh=JQhCSXsyusOxGtjUFqayOObcSsTDfbxU0tyZvY/Vj6A=;\n        b=s2r4/v0DYuqvGNTQcT9zgz4BWyfxkTPOGxK93WLomSMqB2kqeMffyXD89Fq3PXTYvC\n         6a3f07TVZ8Gw1A4aO8hF6jlv0SVJbrghYj/s57G0LdOI3LnabDur/q8QPDXgw63fk2ig\n         uLbcCU6I2nwfbsVw8dEyqYkdF4sQxLG56f/CZauWAQZE7HPiNaGzCzrpl3FASOQdozA0\n         Hj7mn7eaSq2QyW9WKVFVOHUuZMPSwieUUiJlKmn+QRJw89CsmgQOgD+GckIqtGmzCJjl\n         QBFwe37n7jt4+/IaC/kNVoAwZ7pR7i4Pef1JUMosNuxogbTDFzHWjIsq/0+3GfEaCIiC\n         yjKQ==", "X-Google-DKIM-Signature": "v=1; a=rsa-sha256; c=relaxed/relaxed;\n        d=1e100.net; s=20161025;\n        h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version\n         :content-transfer-encoding;\n        bh=JQhCSXsyusOxGtjUFqayOObcSsTDfbxU0tyZvY/Vj6A=;\n        b=Bx93oxsmS4eMBpvIZzem/NvZEl5zsFN7K8TbqUH8T+1Tc96OOWj7NeP8HZm4zKmHXA\n         vH1/X/Kltsbkepm+wsfHlKZg46RAAxE3MWQbcP5TKMvf1vT2lvs16VPQw83qPrd+dW3G\n         g+lC+idUK5HdkDiiKQPL8qXmTvsPKYydwFgeDFK/7l0owXUzZhbwFl4iKLemt4RtiSVT\n         kBi3m0Pt5rckkUCJ+jCaO+88s9M61/M8brDvdRFL+quGtQY+MHcqMUPitJGGiTeO4SjY\n         kWEiw5Ud92TaETL2+lLVIyTn4fcRmYxqJWV0b43V3XKDZ/pjP0RqipGtwNZDaOOawqtU\n         xApA==", "X-Gm-Message-State": "AOAM531looCiXl03v7E1mlWWyb221QfBX/3YVKieJ4IW2gZWW7RBdn6N\n        oMqIFJAf8dBIJT9u+s4PNzRLqUK3clvRPvwv", "X-Google-Smtp-Source": "\n ABdhPJwGyRczTJ1YaqqPoszu5AOFLeprcyPNpPbK+gSRzKVT2oSaTGHdlKyI1sHe4p1gqj2bfhHvng==", "X-Received": "by 2002:adf:c64e:: with SMTP id\n u14mr30375186wrg.373.1602522637731;\n        Mon, 12 Oct 2020 10:10:37 -0700 (PDT)", "From": "Alex Dewar <alex.dewar90@gmail.com>", "Cc": "Alex Dewar <alex.dewar90@gmail.com>,\n        John Fastabend <john.fastabend@gmail.com>,\n        Daniel Borkmann <daniel@iogearbox.net>,\n        Jakub Sitnicki <jakub@cloudflare.com>,\n        Lorenz Bauer <lmb@cloudflare.com>,\n        \"David S. Miller\" <davem@davemloft.net>,\n        Jakub Kicinski <kuba@kernel.org>,\n        Alexei Starovoitov <ast@kernel.org>,\n        Martin KaFai Lau <kafai@fb.com>,\n        Song Liu <songliubraving@fb.com>, Yonghong Song <yhs@fb.com>,\n        Andrii Nakryiko <andrii@kernel.org>,\n        KP Singh <kpsingh@chromium.org>, netdev@vger.kernel.org,\n        bpf@vger.kernel.org, linux-kernel@vger.kernel.org", "Subject": "[PATCH] net: sockmap: Don't call bpf_prog_put() on NULL pointer", "Date": "Mon, 12 Oct 2020 18:09:53 +0100", "Message-Id": "<20201012170952.60750-1-alex.dewar90@gmail.com>", "X-Mailer": "git-send-email 2.28.0", "MIME-Version": "1.0", "Content-Transfer-Encoding": "8bit", "To": "unlisted-recipients:; (no To-header on input)", "Precedence": "bulk", "List-ID": "<bpf.vger.kernel.org>", "X-Mailing-List": "bpf@vger.kernel.org"}, "content": "If bpf_prog_inc_not_zero() fails for skb_parser, then bpf_prog_put() is\ncalled unconditionally on skb_verdict, even though it may be NULL. Fix\nand tidy up error path.\n\nAddresses-Coverity-ID: 1497799: Null pointer dereferences (FORWARD_NULL)\nFixes: 743df8b7749f (\"bpf, sockmap: Check skb_verdict and skb_parser programs explicitly\")\nSigned-off-by: Alex Dewar <alex.dewar90@gmail.com>\n---\n net/core/sock_map.c | 16 +++++++++-------\n 1 file changed, 9 insertions(+), 7 deletions(-)", "diff": "diff --git a/net/core/sock_map.c b/net/core/sock_map.c\nindex df09c39a4dd2..a73ccce54423 100644\n--- a/net/core/sock_map.c\n+++ b/net/core/sock_map.c\n@@ -238,17 +238,18 @@ static int sock_map_link(struct bpf_map *map, struct sk_psock_progs *progs,\n \tint ret;\n \n \tskb_verdict = READ_ONCE(progs->skb_verdict);\n-\tskb_parser = READ_ONCE(progs->skb_parser);\n \tif (skb_verdict) {\n \t\tskb_verdict = bpf_prog_inc_not_zero(skb_verdict);\n \t\tif (IS_ERR(skb_verdict))\n \t\t\treturn PTR_ERR(skb_verdict);\n \t}\n+\n+\tskb_parser = READ_ONCE(progs->skb_parser);\n \tif (skb_parser) {\n \t\tskb_parser = bpf_prog_inc_not_zero(skb_parser);\n \t\tif (IS_ERR(skb_parser)) {\n-\t\t\tbpf_prog_put(skb_verdict);\n-\t\t\treturn PTR_ERR(skb_parser);\n+\t\t\tret = PTR_ERR(skb_parser);\n+\t\t\tgoto out_put_skb_verdict;\n \t\t}\n \t}\n \n@@ -257,7 +258,7 @@ static int sock_map_link(struct bpf_map *map, struct sk_psock_progs *progs,\n \t\tmsg_parser = bpf_prog_inc_not_zero(msg_parser);\n \t\tif (IS_ERR(msg_parser)) {\n \t\t\tret = PTR_ERR(msg_parser);\n-\t\t\tgoto out;\n+\t\t\tgoto out_put_skb_parser;\n \t\t}\n \t}\n \n@@ -311,11 +312,12 @@ static int sock_map_link(struct bpf_map *map, struct sk_psock_progs *progs,\n out_progs:\n \tif (msg_parser)\n \t\tbpf_prog_put(msg_parser);\n-out:\n-\tif (skb_verdict)\n-\t\tbpf_prog_put(skb_verdict);\n+out_put_skb_parser:\n \tif (skb_parser)\n \t\tbpf_prog_put(skb_parser);\n+out_put_skb_verdict:\n+\tif (skb_verdict)\n+\t\tbpf_prog_put(skb_verdict);\n \treturn ret;\n }\n \n", "prefixes": []}, "series/?q= bpf: selftest: Fix flaky tcp_hdr_options test when adding addr to lo&": [{"id": 363589, "url": "https://patchwork.kernel.org/api/1.1/series/363589/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/list/?series=363589", "project": {"id": 399, "url": "https://patchwork.kernel.org/api/1.1/projects/399/", "name": "Netdev + BPF", "link_name": "netdevbpf", "list_id": "bpf.vger.kernel.org", "list_email": "bpf@vger.kernel.org", "web_url": "", "scm_url": "", "webscm_url": ""}, "name": "[bpf] bpf: selftest: Fix flaky tcp_hdr_options test when adding addr to lo", "date": "2020-10-12T23:49:40", "submitter": {"id": 99511, "url": "https://patchwork.kernel.org/api/1.1/people/99511/", "name": "Martin KaFai Lau", "email": "kafai@fb.com"}, "version": 1, "total": 1, "received_total": 1, "received_all": true, "mbox": "https://patchwork.kernel.org/series/363589/mbox/", "cover_letter": null, "patches": [{"id": 11834517, "url": "https://patchwork.kernel.org/api/1.1/patches/11834517/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/patch/20201012234940.1707941-1-kafai@fb.com/", "msgid": "<20201012234940.1707941-1-kafai@fb.com>", "date": "2020-10-12T23:49:40", "name": "[bpf] bpf: selftest: Fix flaky tcp_hdr_options test when adding addr to lo", "mbox": "https://patchwork.kernel.org/project/netdevbpf/patch/20201012234940.1707941-1-kafai@fb.com/mbox/"}]}], "patches/11834517/": {"id": 11834517, "url": "https://patchwork.kernel.org/api/1.1/patches/11834517/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/patch/20201012234940.1707941-1-kafai@fb.com/", "project": {"id": 399, "url": "https://patchwork.kernel.org/api/1.1/projects/399/", "name": "Netdev + BPF", "link_name": "netdevbpf", "list_id": "bpf.vger.kernel.org", "list_email": "bpf@vger.kernel.org", "web_url": "", "scm_url": "", "webscm_url": ""}, "msgid": "<20201012234940.1707941-1-kafai@fb.com>", "date": "2020-10-12T23:49:40", "name": "[bpf] bpf: selftest: Fix flaky tcp_hdr_options test when adding addr to lo", "commit_ref": null, "pull_url": null, "state": "new", "archived": false, "hash": "451c79f5dfa5dd56622b22a605fefdddbfa6026e", "submitter": {"id": 99511, "url": "https://patchwork.kernel.org/api/1.1/people/99511/", "name": "Martin KaFai Lau", "email": "kafai@fb.com"}, "delegate": {"id": 121173, "url": "https://patchwork.kernel.org/api/1.1/users/121173/", "username": "bpf", "first_name": "BPF", "last_name": "", "email": "bpf@iogearbox.net"}, "mbox": "https://patchwork.kernel.org/project/netdevbpf/patch/20201012234940.1707941-1-kafai@fb.com/mbox/", "series": [{"id": 363589, "url": "https://patchwork.kernel.org/api/1.1/series/363589/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/list/?series=363589", "date": "2020-10-12T23:49:40", "name": "[bpf] bpf: selftest: Fix flaky tcp_hdr_options test when adding addr to lo", "version": 1, "mbox": "https://patchwork.kernel.org/series/363589/mbox/"}], "comments": "https://patchwork.kernel.org/api/patches/11834517/comments/", "check": "pending", "checks": "https://patchwork.kernel.org/api/patches/11834517/checks/", "tags": {}, "headers": {"Return-Path": "<SRS0=+vlE=DT=vger.kernel.org=bpf-owner@kernel.org>", "X-Spam-Checker-Version": "SpamAssassin 3.4.0 (2014-02-07) on\n\taws-us-west-2-korg-lkml-1.web.codeaurora.org", "X-Spam-Level": "", "X-Spam-Status": "No, score=-12.8 required=3.0 tests=BAYES_00,DKIMWL_WL_HIGH,\n\tDKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,HEADER_FROM_DIFFERENT_DOMAINS,\n\tINCLUDES_PATCH,MAILING_LIST_MULTI,SIGNED_OFF_BY,SPF_HELO_NONE,SPF_PASS,\n\tURIBL_BLOCKED,USER_AGENT_GIT autolearn=unavailable autolearn_force=no\n\tversion=3.4.0", "Received": ["from mail.kernel.org (mail.kernel.org [198.145.29.99])\n\tby smtp.lore.kernel.org (Postfix) with ESMTP id 1CBB0C433DF\n\tfor <bpf@archiver.kernel.org>; Mon, 12 Oct 2020 23:50:45 +0000 (UTC)", "from vger.kernel.org (vger.kernel.org [23.128.96.18])\n\tby mail.kernel.org (Postfix) with ESMTP id D74A120838\n\tfor <bpf@archiver.kernel.org>; Mon, 12 Oct 2020 23:50:44 +0000 (UTC)", "(majordomo@vger.kernel.org) by vger.kernel.org via listexpand\n        id S2391256AbgJLXuo (ORCPT <rfc822;bpf@archiver.kernel.org>);\n        Mon, 12 Oct 2020 19:50:44 -0400", "from mx0a-00082601.pphosted.com ([67.231.145.42]:34478 \"EHLO\n        mx0a-00082601.pphosted.com\" rhost-flags-OK-OK-OK-OK)\n        by vger.kernel.org with ESMTP id S2389686AbgJLXuF (ORCPT\n        <rfc822;bpf@vger.kernel.org>); Mon, 12 Oct 2020 19:50:05 -0400", "from pps.filterd (m0044010.ppops.net [127.0.0.1])\n        by mx0a-00082601.pphosted.com (8.16.0.42/8.16.0.42) with SMTP id\n 09CNnvgl003592\n        for <bpf@vger.kernel.org>; Mon, 12 Oct 2020 16:50:04 -0700", "from maileast.thefacebook.com ([163.114.130.16])\n        by mx0a-00082601.pphosted.com with ESMTP id 343vfbqy9s-7\n        (version=TLSv1.2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128\n verify=NOT)\n        for <bpf@vger.kernel.org>; Mon, 12 Oct 2020 16:50:04 -0700", "from intmgw003.03.ash8.facebook.com (2620:10d:c0a8:1b::d) by\n mail.thefacebook.com (2620:10d:c0a8:82::f) with Microsoft SMTP Server\n (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id\n 15.1.1979.3; Mon, 12 Oct 2020 16:49:41 -0700", "by devbig005.ftw2.facebook.com (Postfix, from userid 6611)\n        id 5722329464F4; Mon, 12 Oct 2020 16:49:40 -0700 (PDT)"], "Authentication-Results": "mail.kernel.org;\n\tdkim=pass (1024-bit key) header.d=fb.com header.i=@fb.com header.b=\"F1RqRx3N\"", "DKIM-Signature": "v=1; a=rsa-sha256; c=relaxed/relaxed; d=fb.com;\n h=from : to : cc : subject\n : date : message-id : mime-version : content-type :\n content-transfer-encoding; s=facebook;\n bh=DTTjSIB8MQVwaw/rlRdz1VKVb2ywGrMhX8K8wwM/Q8A=;\n b=F1RqRx3N1yK4neRImzmcBYQlrYKb3ZSUlKS42JcTG3JlVJAPsw/kz0rAUSX+LMNY2pFD\n 0LqfnbYD/otGyria+I7W5nTxcbLm+bu6DYDNtDXXXoGL5KyfWqaG/SndxCIha/dpVWHI\n QiKZNKtKn9TxanOxvveGvF1pVkPrD7saBlU=", "From": "Martin KaFai Lau <kafai@fb.com>", "To": "<bpf@vger.kernel.org>", "CC": "Alexei Starovoitov <ast@kernel.org>,\n        Daniel Borkmann <daniel@iogearbox.net>, <kernel-team@fb.com>,\n        <netdev@vger.kernel.org>, Andrii Nakryiko <andriin@fb.com>", "Subject": "[PATCH bpf] bpf: selftest: Fix flaky tcp_hdr_options test when adding\n addr to lo", "Date": "Mon, 12 Oct 2020 16:49:40 -0700", "Message-ID": "<20201012234940.1707941-1-kafai@fb.com>", "X-Mailer": "git-send-email 2.24.1", "MIME-Version": "1.0", "X-FB-Internal": ["Safe", "deliver"], "Content-Type": "text/plain", "Content-Transfer-Encoding": "quoted-printable", "X-Proofpoint-Virus-Version": "vendor=fsecure engine=2.50.10434:6.0.235,18.0.687\n definitions=2020-10-12_18:2020-10-12,2020-10-12 signatures=0", "X-Proofpoint-Spam-Details": "rule=fb_default_notspam policy=fb_default score=0\n phishscore=0\n lowpriorityscore=0 spamscore=0 priorityscore=1501 impostorscore=0\n bulkscore=0 mlxscore=0 malwarescore=0 mlxlogscore=999 clxscore=1015\n adultscore=0 suspectscore=13 classifier=spam adjust=0 reason=mlx\n scancount=1 engine=8.12.0-2009150000 definitions=main-2010120174", "Precedence": "bulk", "List-ID": "<bpf.vger.kernel.org>", "X-Mailing-List": "bpf@vger.kernel.org", "X-Patchwork-Delegate": "bpf@iogearbox.net"}, "content": "The tcp_hdr_options test adds a \"::eB9F\" addr to the lo dev.\nHowever, this non loopback address will have a race on ipv6 dad\nwhich may lead to EADDRNOTAVAIL error from time to time.\n\nEven nodad is used in the iproute2 command, there is still a race in\nwhen the route will be added.  This will then lead to ENETUNREACH from\ntime to time.\n\nTo avoid the above, this patch uses the default loopback address \"::1\"\nto do the test.\n\nFixes: ad2f8eb0095e (\"bpf: selftests: Tcp header options\")\nReported-by: Andrii Nakryiko <andriin@fb.com>\nSigned-off-by: Martin KaFai Lau <kafai@fb.com>\n---\n .../bpf/prog_tests/tcp_hdr_options.c          | 26 +------------------\n .../bpf/progs/test_misc_tcp_hdr_options.c     |  2 +-\n 2 files changed, 2 insertions(+), 26 deletions(-)", "diff": "diff --git a/tools/testing/selftests/bpf/prog_tests/tcp_hdr_options.c b/tools/testing/selftests/bpf/prog_tests/tcp_hdr_options.c\nindex c86e67214a9e..c85174cdcb77 100644\n--- a/tools/testing/selftests/bpf/prog_tests/tcp_hdr_options.c\n+++ b/tools/testing/selftests/bpf/prog_tests/tcp_hdr_options.c\n@@ -15,7 +15,7 @@\n #include \"test_tcp_hdr_options.skel.h\"\n #include \"test_misc_tcp_hdr_options.skel.h\"\n \n-#define LO_ADDR6 \"::eB9F\"\n+#define LO_ADDR6 \"::1\"\n #define CG_NAME \"/tcpbpf-hdr-opt-test\"\n \n struct bpf_test_option exp_passive_estab_in;\n@@ -40,27 +40,6 @@ struct sk_fds {\n \tint active_lport;\n };\n \n-static int add_lo_addr(void)\n-{\n-\tchar ip_addr_cmd[256];\n-\tint cmdlen;\n-\n-\tcmdlen = snprintf(ip_addr_cmd, sizeof(ip_addr_cmd),\n-\t\t\t  \"ip -6 addr add %s/128 dev lo scope host\",\n-\t\t\t  LO_ADDR6);\n-\n-\tif (CHECK(cmdlen >= sizeof(ip_addr_cmd), \"compile ip cmd\",\n-\t\t  \"failed to add host addr %s to lo. ip cmdlen is too long\\n\",\n-\t\t  LO_ADDR6))\n-\t\treturn -1;\n-\n-\tif (CHECK(system(ip_addr_cmd), \"run ip cmd\",\n-\t\t  \"failed to add host addr %s to lo\\n\", LO_ADDR6))\n-\t\treturn -1;\n-\n-\treturn 0;\n-}\n-\n static int create_netns(void)\n {\n \tif (CHECK(unshare(CLONE_NEWNET), \"create netns\",\n@@ -72,9 +51,6 @@ static int create_netns(void)\n \t\t  \"failed to bring lo link up\\n\"))\n \t\treturn -1;\n \n-\tif (add_lo_addr())\n-\t\treturn -1;\n-\n \treturn 0;\n }\n \ndiff --git a/tools/testing/selftests/bpf/progs/test_misc_tcp_hdr_options.c b/tools/testing/selftests/bpf/progs/test_misc_tcp_hdr_options.c\nindex 72ec0178f653..6077a025092c 100644\n--- a/tools/testing/selftests/bpf/progs/test_misc_tcp_hdr_options.c\n+++ b/tools/testing/selftests/bpf/progs/test_misc_tcp_hdr_options.c\n@@ -16,7 +16,7 @@\n #define BPF_PROG_TEST_TCP_HDR_OPTIONS\n #include \"test_tcp_hdr_options.h\"\n \n-__u16 last_addr16_n = __bpf_htons(0xeB9F);\n+__u16 last_addr16_n = __bpf_htons(1);\n __u16 active_lport_n = 0;\n __u16 active_lport_h = 0;\n __u16 passive_lport_n = 0;\n", "prefixes": ["bpf"]}, "series/?q= selftests/bpf: fix compilation error in progs/profiler.inc.h&": [{"id": 364283, "url": "https://patchwork.kernel.org/api/1.1/series/364283/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/list/?series=364283", "project": {"id": 399, "url": "https://patchwork.kernel.org/api/1.1/projects/399/", "name": "Netdev + BPF", "link_name": "netdevbpf", "list_id": "bpf.vger.kernel.org", "list_email": "bpf@vger.kernel.org", "web_url": "", "scm_url": "", "webscm_url": ""}, "name": "[bpf-next] selftests/bpf: fix compilation error in progs/profiler.inc.h", "date": "2020-10-14T04:36:38", "submitter": {"id": 172541, "url": "https://patchwork.kernel.org/api/1.1/people/172541/", "name": "Song Liu", "email": "songliubraving@fb.com"}, "version": 1, "total": 1, "received_total": 1, "received_all": true, "mbox": "https://patchwork.kernel.org/series/364283/mbox/", "cover_letter": null, "patches": [{"id": 11836751, "url": "https://patchwork.kernel.org/api/1.1/patches/11836751/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/patch/20201014043638.3770558-1-songliubraving@fb.com/", "msgid": "<20201014043638.3770558-1-songliubraving@fb.com>", "date": "2020-10-14T04:36:38", "name": "[bpf-next] selftests/bpf: fix compilation error in progs/profiler.inc.h", "mbox": "https://patchwork.kernel.org/project/netdevbpf/patch/20201014043638.3770558-1-songliubraving@fb.com/mbox/"}]}], "patches/11836751/": {"id": 11836751, "url": "https://patchwork.kernel.org/api/1.1/patches/11836751/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/patch/20201014043638.3770558-1-songliubraving@fb.com/", "project": {"id": 399, "url": "https://patchwork.kernel.org/api/1.1/projects/399/", "name": "Netdev + BPF", "link_name": "netdevbpf", "list_id": "bpf.vger.kernel.org", "list_email": "bpf@vger.kernel.org", "web_url": "", "scm_url": "", "webscm_url": ""}, "msgid": "<20201014043638.3770558-1-songliubraving@fb.com>", "date": "2020-10-14T04:36:38", "name": "[bpf-next] selftests/bpf: fix compilation error in progs/profiler.inc.h", "commit_ref": null, "pull_url": null, "state": "new", "archived": false, "hash": "af6c42693fdf608dd3ff5981dd1eb261082d1958", "submitter": {"id": 172541, "url": "https://patchwork.kernel.org/api/1.1/people/172541/", "name": "Song Liu", "email": "songliubraving@fb.com"}, "delegate": {"id": 121173, "url": "https://patchwork.kernel.org/api/1.1/users/121173/", "username": "bpf", "first_name": "BPF", "last_name": "", "email": "bpf@iogearbox.net"}, "mbox": "https://patchwork.kernel.org/project/netdevbpf/patch/20201014043638.3770558-1-songliubraving@fb.com/mbox/", "series": [{"id": 364283, "url": "https://patchwork.kernel.org/api/1.1/series/364283/", "web_url": "https://patchwork.kernel.org/project/netdevbpf/list/?series=364283", "date": "2020-10-14T04:36:38", "name": "[bpf-next] selftests/bpf: fix compilation error in progs/profiler.inc.h", "version": 1, "mbox": "https://patchwork.kernel.org/series/364283/mbox/"}], "comments": "https://patchwork.kernel.org/api/patches/11836751/comments/", "check": "pending", "checks": "https://patchwork.kernel.org/api/patches/11836751/checks/", "tags": {}, "headers": {"Return-Path": "<SRS0=xWwI=DV=vger.kernel.org=bpf-owner@kernel.org>", "X-Spam-Checker-Version": "SpamAssassin 3.4.0 (2014-02-07) on\n\taws-us-west-2-korg-lkml-1.web.codeaurora.org", "X-Spam-Level": "", "X-Spam-Status": "No, score=-12.8 required=3.0 tests=BAYES_00,DKIMWL_WL_HIGH,\n\tDKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,HEADER_FROM_DIFFERENT_DOMAINS,\n\tINCLUDES_PATCH,MAILING_LIST_MULTI,SIGNED_OFF_BY,SPF_HELO_NONE,SPF_PASS,\n\tURIBL_BLOCKED,USER_AGENT_GIT autolearn=unavailable autolearn_force=no\n\tversion=3.4.0", "Received": ["from mail.kernel.org (mail.kernel.org [198.145.29.99])\n\tby smtp.lore.kernel.org (Postfix) with ESMTP id 36B69C433DF\n\tfor <bpf@archiver.kernel.org>; Wed, 14 Oct 2020 04:36:56 +0000 (UTC)", "from vger.kernel.org (vger.kernel.org [23.128.96.18])\n\tby mail.kernel.org (Postfix) with ESMTP id E273F2222C\n\tfor <bpf@archiver.kernel.org>; Wed, 14 Oct 2020 04:36:55 +0000 (UTC)", "(majordomo@vger.kernel.org) by vger.kernel.org via listexpand\n        id S1730017AbgJNEgy (ORCPT <rfc822;bpf@archiver.kernel.org>);\n        Wed, 14 Oct 2020 00:36:54 -0400", "from mx0b-00082601.pphosted.com ([67.231.153.30]:19812 \"EHLO\n        mx0b-00082601.pphosted.com\" rhost-flags-OK-OK-OK-OK)\n        by vger.kernel.org with ESMTP id S1729995AbgJNEgy (ORCPT\n        <rfc822;bpf@vger.kernel.org>); Wed, 14 Oct 2020 00:36:54 -0400", "from pps.filterd (m0148460.ppops.net [127.0.0.1])\n        by mx0a-00082601.pphosted.com (8.16.0.42/8.16.0.42) with SMTP id\n 09E4ZM1l011016\n        for <bpf@vger.kernel.org>; Tue, 13 Oct 2020 21:36:53 -0700", "from maileast.thefacebook.com ([163.114.130.16])\n        by mx0a-00082601.pphosted.com with ESMTP id 345ff5k721-2\n        (version=TLSv1.2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128\n verify=NOT)\n        for <bpf@vger.kernel.org>; Tue, 13 Oct 2020 21:36:53 -0700", "from intmgw003.03.ash8.facebook.com (2620:10d:c0a8:1b::d) by\n mail.thefacebook.com (2620:10d:c0a8:83::7) with Microsoft SMTP Server\n (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id\n 15.1.1979.3; Tue, 13 Oct 2020 21:36:52 -0700", "by devbig006.ftw2.facebook.com (Postfix, from userid 4523)\n        id 662C862E1AE9; Tue, 13 Oct 2020 21:36:41 -0700 (PDT)"], "Authentication-Results": "mail.kernel.org;\n\tdkim=pass (1024-bit key) header.d=fb.com header.i=@fb.com header.b=\"aFeEuhWh\"", "DKIM-Signature": "v=1; a=rsa-sha256; c=relaxed/relaxed; d=fb.com;\n h=from : to : cc : subject\n : date : message-id : mime-version : content-type :\n content-transfer-encoding; s=facebook;\n bh=sl7Keq768JmYFP2QGaRO4xIW+BR0M1wIdYM0fJxUwXE=;\n b=aFeEuhWhXweCDqnRWk9q5mMw5Vmj7Wl/9zKjNPKtt9umKDdv39fEYy/lbgZn/c7lwg6B\n HgI8eZsGZ7MbNSz77b/+gTlrR64rbsTiSsuRO4Gpz69W9NxJPMLIbI/FPcGHHkXejHZj\n iakMx35SwnAUPpUWBjDsFHZK7a/e/Kc6WxI=", "From": "Song Liu <songliubraving@fb.com>", "To": "<netdev@vger.kernel.org>, <bpf@vger.kernel.org>", "CC": "<kernel-team@fb.com>, <ast@kernel.org>, <daniel@iogearbox.net>,\n        <john.fastabend@gmail.com>, <kpsingh@chromium.org>,\n        Song Liu <songliubraving@fb.com>", "Subject": "[PATCH bpf-next] selftests/bpf: fix compilation error in\n progs/profiler.inc.h", "Date": "Tue, 13 Oct 2020 21:36:38 -0700", "Message-ID": "<20201014043638.3770558-1-songliubraving@fb.com>", "X-Mailer": "git-send-email 2.24.1", "MIME-Version": "1.0", "X-FB-Internal": ["Safe", "deliver"], "Content-Type": "text/plain", "Content-Transfer-Encoding": "quoted-printable", "X-Proofpoint-Virus-Version": "vendor=fsecure engine=2.50.10434:6.0.235,18.0.687\n definitions=2020-10-14_02:2020-10-14,2020-10-14 signatures=0", "X-Proofpoint-Spam-Details": "rule=fb_default_notspam policy=fb_default score=0\n lowpriorityscore=0\n malwarescore=0 suspectscore=0 bulkscore=0 mlxscore=0 spamscore=0\n impostorscore=0 priorityscore=1501 phishscore=0 adultscore=0\n mlxlogscore=999 clxscore=1015 classifier=spam adjust=0 reason=mlx\n scancount=1 engine=8.12.0-2009150000 definitions=main-2010140031", "Precedence": "bulk", "List-ID": "<bpf.vger.kernel.org>", "X-Mailing-List": "bpf@vger.kernel.org", "X-Patchwork-Delegate": "bpf@iogearbox.net"}, "content": "Fix the following error when compiling selftests/bpf\n\nprogs/profiler.inc.h:246:5: error: redefinition of 'pids_cgrp_id' as different kind of symbol\n\npids_cgrp_id is used in cgroup code, and included in vmlinux.h. Fix the\nerror by renaming pids_cgrp_id as pids_cgroup_id.\n\nFixes: 03d4d13fab3f (\"selftests/bpf: Add profiler test\")\nSigned-off-by: Song Liu <songliubraving@fb.com>\n---\n tools/testing/selftests/bpf/progs/profiler.inc.h | 4 ++--\n 1 file changed, 2 insertions(+), 2 deletions(-)", "diff": "diff --git a/tools/testing/selftests/bpf/progs/profiler.inc.h b/tools/testing/selftests/bpf/progs/profiler.inc.h\nindex 00578311a4233..b554c1e40b9fb 100644\n--- a/tools/testing/selftests/bpf/progs/profiler.inc.h\n+++ b/tools/testing/selftests/bpf/progs/profiler.inc.h\n@@ -243,7 +243,7 @@ static ino_t get_inode_from_kernfs(struct kernfs_node* node)\n \t}\n }\n \n-int pids_cgrp_id = 1;\n+int pids_cgroup_id = 1;\n \n static INLINE void* populate_cgroup_info(struct cgroup_data_t* cgroup_data,\n \t\t\t\t\t struct task_struct* task,\n@@ -262,7 +262,7 @@ static INLINE void* populate_cgroup_info(struct cgroup_data_t* cgroup_data,\n \t\t\t\tBPF_CORE_READ(task, cgroups, subsys[i]);\n \t\t\tif (subsys != NULL) {\n \t\t\t\tint subsys_id = BPF_CORE_READ(subsys, ss, id);\n-\t\t\t\tif (subsys_id == pids_cgrp_id) {\n+\t\t\t\tif (subsys_id == pids_cgroup_id) {\n \t\t\t\t\tproc_kernfs = BPF_CORE_READ(subsys, cgroup, kn);\n \t\t\t\t\troot_kernfs = BPF_CORE_READ(subsys, ss, root, kf_root, kn);\n \t\t\t\t\tbreak;\n", "prefixes": ["bpf-next"]}}